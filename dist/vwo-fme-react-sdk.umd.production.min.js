
/**
 * Copyright 2025 Wingify Software Pvt. Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("react"),require("vwo-fme-node-sdk"),require("@wingify/service-logger"),require("@wingify/util-data-type")):"function"==typeof define&&define.amd?define(["exports","react","vwo-fme-node-sdk","@wingify/service-logger","@wingify/util-data-type"],r):r((e=e||self)["vwo-fme-react-sdk"]={},e.React,e.vwoFmeNodeSdk,e.serviceLogger,e.utilDataType)}(this,(function(e,r,t,o,n){"use strict";var i="default"in r?r.default:r;let a=null;function _(e){return a||(a=new o.LogManager((null==e?void 0:e.logger)||{})),a}function E(){return a||(a=new o.LogManager({level:"error"})),a}var s;!function(e){e.VWO_CLIENT_MISSING="VWO Client is missing in {hookName} hook. Ensure VWOProvider is correctly initialized.",e.INVALID_CONTEXT="Invalid user context in {hookName} hook. Ensure a valid userContext is provided.",e.HOOK_ERROR="Error in {hookName} hook: {error}",e.INVALID_HOOK_USAGE="{hookName} must be used within a VWOProvider !!",e.VWO_PROVIDER_CLIENT_CONFIG_WARNING="VWOProvider Warning: Both `client` and `config` are provided. The `client` prop will take precedence, and the `config` props will be disregarded.",e.VWO_PROVIDER_CONFIG_REQUIRED="VWOProvider Error: Either `client` or `config` must be provided.",e.VWO_SDK_INITIALIZATION_FAILED="VWO-SDK Initialization failed: {error}",e.VWO_TRACK_EVENT_NAME_REQUIRED="Event name is required for useTrackEvent hook and it should be a string",e.VWO_TRACK_EVENT_ERROR="Error tracking event - {eventName}: {error}",e.VWO_SET_ATTRIBUTE_MAP_REQUIRED="attributeMap (object having key-value pairs of user attributes) is required for useSetAttribute hook",e.VWO_SET_ATTRIBUTE_ERROR="Error setting attributes: {error}",e.VWO_SET_ATTRIBUTE_SUCCESS="User attributes set: {attributes}",e.VWO_NOT_READY_IN_USE_GET_FLAG="VWO is not ready in useGetFlag hook",e.VWO_GET_FLAG_FEATURE_KEY_REQUIRED="Feature key is required for useGetFlag hook",e.VWO_GET_FLAG_ERROR="Error fetching feature flag - {featureKey}: {error}",e.VWO_GET_FLAG_VARIABLES_FLAG_REQUIRED="Flag is required for useGetFlagVariables hook and should be an object",e.VWO_GET_FLAG_VARIABLES_ERROR="Error getting flag variables: {error}",e.VWO_GET_FLAG_VARIABLE_REQUIRED="Flag and variable key are required for useGetFlagVariable hook",e.VWO_GET_FLAG_VARIABLE_ERROR="Error getting flag variable: {error}"}(s||(s={}));const u=/\{([0-9a-zA-Z_]+)\}/g;function l(e,r={}){try{return e.replace(u,(t,o,i)=>{if("{"===e[i-1]&&"}"===e[i+t.length])return o;const a=r[o];return null==a?"":n.isFunction(a)?a():a})}catch(r){return e}}var O;!function(e){e.VWO_CLIENT="useVWOClient",e.VWO_CONTEXT="useVWOContext",e.VWO_GET_FLAG="useGetFlag",e.VWO_GET_FLAG_VARIABLE="useGetFlagVariable",e.VWO_GET_FLAG_VARIABLES="useGetFlagVariables",e.VWO_TRACK_EVENT="useTrackEvent",e.VWO_SET_ATTRIBUTE="useSetAttribute"}(O||(O={}));const R=r.createContext({vwoClient:null,userContext:null,setUserContext:void 0,isReady:!1}),c=()=>{const e=E();try{return r.useContext(R)||(e.error(l(s.INVALID_HOOK_USAGE,{hookName:O.VWO_CONTEXT})),null)}catch(r){return e.error(l(s.HOOK_ERROR,{error:r,hookName:O.VWO_CONTEXT})),null}},T={vwoClient:null,isReady:!1};Object.defineProperty(e,"Flag",{enumerable:!0,get:function(){return t.Flag}}),Object.defineProperty(e,"LogLevelEnum",{enumerable:!0,get:function(){return t.LogLevelEnum}}),Object.defineProperty(e,"StorageConnector",{enumerable:!0,get:function(){return t.StorageConnector}}),Object.defineProperty(e,"init",{enumerable:!0,get:function(){return t.init}}),e.VWOProvider=function(e){const{userContext:o,children:n,fallbackComponent:a}=e,E="client"in e?e.client:null,u="config"in e?e.config:null,[O,c]=r.useState(E||null),[T,V]=r.useState(o||null),[A,I]=r.useState(!1),d=_((null==E?void 0:E.options)||u),f=r.useMemo(()=>u||(null==E?void 0:E.options),[]);return r.useEffect(()=>{u&&O&&d.warn(s.VWO_PROVIDER_CLIENT_CONFIG_WARNING),O?I(!0):u?!O&&u&&(async()=>{try{if(!O&&u){const e=await t.init(u);c(e),I(!0)}}catch(e){d.error(l(s.VWO_SDK_INITIALIZATION_FAILED,{error:e}))}})():d.error(s.VWO_PROVIDER_CONFIG_REQUIRED)},[f]),i.createElement(R.Provider,{value:{vwoClient:O,userContext:T,setUserContext:V,isReady:A}},a&&!A?a:n)},e.useGetFlag=(e,t)=>{const{vwoClient:o,userContext:i,setUserContext:a,isReady:_}=c(),[u,R]=r.useState({isEnabled:()=>!1,getVariables:()=>[],getVariable:(e,r)=>r}),[T,V]=r.useState(!0),A=E(),I=r.useMemo(()=>t||i||{},[JSON.stringify(t||i||{})]),d=r.useCallback(async()=>{try{if(!_)return void A.error(s.VWO_NOT_READY_IN_USE_GET_FLAG);const r=await o.getFlag(e,I);R(r),a(I)}catch(r){A.error(l(s.VWO_GET_FLAG_ERROR,{featureKey:e,error:r}))}finally{V(!1)}},[e,I,_]);return r.useEffect(()=>{e?n.isObject(I)&&I.id?_&&o&&I&&d():A.error(l(s.INVALID_CONTEXT,{hookName:O.VWO_GET_FLAG})):A.error(s.VWO_GET_FLAG_FEATURE_KEY_REQUIRED)},[e,JSON.stringify(I),_]),{flag:u,isReady:!T&&!!u}},e.useGetFlagVariable=(e,r,t)=>{const o=E();try{return e&&n.isObject(e)?r?e.getVariable(r,t):(o.error(s.VWO_GET_FLAG_VARIABLE_REQUIRED),t):t}catch(e){return o.error(l(s.VWO_GET_FLAG_VARIABLE_ERROR,{error:e})),t}},e.useGetFlagVariables=e=>{const r=E();try{return e&&n.isObject(e)?e.getVariables():(r.error(s.VWO_GET_FLAG_VARIABLES_FLAG_REQUIRED),[])}catch(e){return r.error(l(s.VWO_GET_FLAG_VARIABLES_ERROR,{error:e})),[]}},e.useSetAttribute=()=>{const e=E(),{vwoClient:r,userContext:t,isReady:o}=c();return{setAttribute:i=>{if(o)if(t&&n.isObject(t)&&t.id)if(i&&n.isObject(i)&&0!==Object.keys(i).length)try{r.setAttribute(i,t),e.info(l(s.VWO_SET_ATTRIBUTE_SUCCESS,{attributes:JSON.stringify(i)}))}catch(r){e.error(l(s.VWO_SET_ATTRIBUTE_ERROR,{error:r}))}else e.error(s.VWO_SET_ATTRIBUTE_MAP_REQUIRED);else e.error(l(s.INVALID_CONTEXT,{hookName:O.VWO_SET_ATTRIBUTE}));else e.error(l(s.VWO_CLIENT_MISSING,{hookName:O.VWO_SET_ATTRIBUTE}))},isReady:o}},e.useTrackEvent=()=>{const e=E(),{vwoClient:r,userContext:t,isReady:o}=c();return{trackEvent:async(i,a={})=>{if(!o)return e.error(l(s.VWO_CLIENT_MISSING,{hookName:O.VWO_TRACK_EVENT})),Promise.resolve({});if(!i||!n.isString(i))return e.error(s.VWO_TRACK_EVENT_NAME_REQUIRED),Promise.resolve({});if(!t||!n.isObject(t)||!t.id)return e.error(l(s.INVALID_CONTEXT,{hookName:O.VWO_TRACK_EVENT})),Promise.resolve({});try{return await r.trackEvent(i,t,a)}catch(r){return e.error(l(s.VWO_TRACK_EVENT_ERROR,{eventName:i,error:r instanceof Error?r.message:r})),Promise.resolve({})}},isReady:o}},e.useVWOClient=()=>{const e=E();try{const r=c();return r?r.isReady?{vwoClient:r.vwoClient,isReady:!0}:T:(e.error(l(s.INVALID_HOOK_USAGE,{hookName:O.VWO_CLIENT})),T)}catch(r){return e.error(l(s.HOOK_ERROR,{error:r,hookName:O.VWO_CLIENT})),T}},e.useVWOContext=c,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=vwo-fme-react-sdk.umd.production.min.js.map
