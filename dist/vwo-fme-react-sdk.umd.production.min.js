
/**
 * Copyright 2025 Wingify Software Pvt. Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("react"),require("vwo-fme-node-sdk"),require("@wingify/service-logger"),require("@wingify/util-data-type")):"function"==typeof define&&define.amd?define(["exports","react","vwo-fme-node-sdk","@wingify/service-logger","@wingify/util-data-type"],r):r((e=e||self)["vwo-fme-react-sdk"]={},e.React,e.vwoFmeNodeSdk,e.serviceLogger,e.utilDataType)}(this,(function(e,r,t,o,i){"use strict";var n="default"in r?r.default:r;let a=null;function _(e){return a||(a=new o.LogManager((null==e?void 0:e.logger)||{})),a}function E(){return a||(a=new o.LogManager({level:"error"})),a}var u;!function(e){e.VWO_CLIENT_MISSING="VWO Client is missing in {hookName} hook. Ensure VWOProvider is correctly initialized.",e.INVALID_CONTEXT="Invalid user context in {hookName} hook. Ensure a valid userContext is provided.",e.HOOK_ERROR="Error in {hookName} hook: {error}",e.INVALID_HOOK_USAGE="{hookName} must be used within a VWOProvider !!",e.VWO_PROVIDER_CLIENT_CONFIG_WARNING="VWOProvider Warning: Both `client` and `config` are provided. The `client` prop will take precedence, and the `config` props will be disregarded.",e.VWO_PROVIDER_CONFIG_REQUIRED="VWOProvider Error: Either `client` or `config` must be provided.",e.VWO_SDK_INITIALIZATION_FAILED="VWO-SDK Initialization failed: {error}",e.VWO_TRACK_EVENT_NAME_REQUIRED="Event name is required for useTrackEvent hook and it should be a string",e.VWO_TRACK_EVENT_ERROR="Error tracking event - {eventName}: {error}",e.VWO_SET_ATTRIBUTE_MAP_REQUIRED="attributeMap (object having key-value pairs of user attributes) is required for useSetAttribute hook",e.VWO_SET_ATTRIBUTE_ERROR="Error setting attributes: {error}",e.VWO_SET_ATTRIBUTE_SUCCESS="User attributes set: {attributes}",e.VWO_NOT_READY_IN_USE_GET_FLAG="VWO is not ready in useGetFlag hook",e.VWO_GET_FLAG_FEATURE_KEY_REQUIRED="Feature key is required for useGetFlag hook",e.VWO_GET_FLAG_ERROR="Error fetching feature flag - {featureKey}: {error}",e.VWO_GET_FLAG_VARIABLES_FLAG_REQUIRED="Flag is required for useGetFlagVariables hook and should be an object",e.VWO_GET_FLAG_VARIABLES_ERROR="Error getting flag variables: {error}",e.VWO_GET_FLAG_VARIABLE_REQUIRED="Flag and variable key are required for useGetFlagVariable hook",e.VWO_GET_FLAG_VARIABLE_ERROR="Error getting flag variable: {error}"}(u||(u={}));const s=/\{([0-9a-zA-Z_]+)\}/g;function l(e,r={}){try{return e.replace(s,(t,o,n)=>{if("{"===e[n-1]&&"}"===e[n+t.length])return o;const a=r[o];return null==a?"":i.isFunction(a)?a():a})}catch(r){return e}}function R(e,r={},t){try{e.error(l(t,r))}catch(e){console.error("Error logging hook. Error: "+e)}}var O;!function(e){e.VWO_CLIENT="useVWOClient",e.VWO_CONTEXT="useVWOContext",e.VWO_GET_FLAG="useGetFlag",e.VWO_GET_FLAG_VARIABLE="useGetFlagVariable",e.VWO_GET_FLAG_VARIABLES="useGetFlagVariables",e.VWO_TRACK_EVENT="useTrackEvent",e.VWO_SET_ATTRIBUTE="useSetAttribute"}(O||(O={}));const c=r.createContext({vwoClient:null,userContext:null,setUserContext:void 0,isReady:!1}),T=()=>{let e;try{return e=E(),r.useContext(c)||(e.error(l(u.INVALID_HOOK_USAGE,{hookName:O.VWO_CONTEXT})),null)}catch(r){return R(e,{error:r,hookName:O.VWO_CONTEXT},u.HOOK_ERROR),null}},V={vwoClient:null,isReady:!1};Object.defineProperty(e,"Flag",{enumerable:!0,get:function(){return t.Flag}}),Object.defineProperty(e,"LogLevelEnum",{enumerable:!0,get:function(){return t.LogLevelEnum}}),Object.defineProperty(e,"StorageConnector",{enumerable:!0,get:function(){return t.StorageConnector}}),Object.defineProperty(e,"init",{enumerable:!0,get:function(){return t.init}}),e.VWOProvider=function(e){const{userContext:o,children:i,fallbackComponent:a}=e,E="client"in e?e.client:null,s="config"in e?e.config:null,[l,O]=r.useState(E||null),[T,V]=r.useState(o||null),[A,d]=r.useState(!1),I=r.useMemo(()=>s||(null==E?void 0:E.options),[]);let f;return r.useEffect(()=>{try{if(f=_((null==E?void 0:E.options)||s),s&&l&&f.warn(u.VWO_PROVIDER_CLIENT_CONFIG_WARNING),l)return void d(!0);if(!s)return void f.error(u.VWO_PROVIDER_CONFIG_REQUIRED);const e=async()=>{if(!l&&s){const e=await t.init(s);O(e),d(!0)}};!l&&s&&e()}catch(e){R(f,e,u.VWO_SDK_INITIALIZATION_FAILED)}},[I]),n.createElement(c.Provider,{value:{vwoClient:l,userContext:T,setUserContext:V,isReady:A}},a&&!A?a:i)},e.useGetFlag=(e,t)=>{const{vwoClient:o,userContext:n,setUserContext:a,isReady:_}=T(),[s,c]=r.useState({isEnabled:()=>!1,getVariables:()=>[],getVariable:(e,r)=>r}),[V,A]=r.useState(!0),d=E(),I=r.useMemo(()=>t||n||{},[JSON.stringify(t||n||{})]),f=r.useCallback(async()=>{try{if(!_)return void d.error(u.VWO_NOT_READY_IN_USE_GET_FLAG);const r=await o.getFlag(e,I);c(r),a(I)}catch(r){R(d,{error:r,featureKey:e},u.VWO_GET_FLAG_ERROR)}finally{A(!1)}},[e,I,_]);return r.useEffect(()=>{try{if(!e)return void d.error(u.VWO_GET_FLAG_FEATURE_KEY_REQUIRED);if(!i.isObject(I)||!I.id)return void d.error(l(u.INVALID_CONTEXT,{hookName:O.VWO_GET_FLAG}));_&&o&&I&&f()}catch(r){R(d,{error:r,featureKey:e},u.VWO_GET_FLAG_ERROR)}},[e,JSON.stringify(I),_]),{flag:s,isReady:!V&&!!s}},e.useGetFlagVariable=(e,r,t)=>{let o;try{return o=E(),e&&i.isObject(e)?r?e.getVariable(r,t):(o.error(u.VWO_GET_FLAG_VARIABLE_REQUIRED),t):t}catch(e){return R(o,{error:e},u.VWO_GET_FLAG_VARIABLE_ERROR),t}},e.useGetFlagVariables=e=>{let r;try{return r=E(),e&&i.isObject(e)?e.getVariables():(r.error(u.VWO_GET_FLAG_VARIABLES_FLAG_REQUIRED),[])}catch(e){return R(r,{error:e},u.VWO_GET_FLAG_VARIABLES_ERROR),[]}},e.useSetAttribute=()=>{let e,r,t,o;try{e=E(),({vwoClient:r,userContext:t,isReady:o}=T())}catch(r){return R(e,{error:r},u.VWO_SET_ATTRIBUTE_ERROR),{setAttribute:()=>{},isReady:!1}}return{setAttribute:n=>{try{if(!o)return void e.error(l(u.VWO_CLIENT_MISSING,{hookName:O.VWO_SET_ATTRIBUTE}));if(!t||!i.isObject(t)||!t.id)return void e.error(l(u.INVALID_CONTEXT,{hookName:O.VWO_SET_ATTRIBUTE}));if(!n||!i.isObject(n)||0===Object.keys(n).length)return void e.error(u.VWO_SET_ATTRIBUTE_MAP_REQUIRED);r.setAttribute(n,t),e.info(l(u.VWO_SET_ATTRIBUTE_SUCCESS,{attributes:JSON.stringify(n)}))}catch(r){R(e,{error:r},u.VWO_SET_ATTRIBUTE_ERROR)}},isReady:o}},e.useTrackEvent=()=>{let e,r,t,o;try{e=E(),({vwoClient:r,userContext:t,isReady:o}=T())}catch(r){return R(e,{error:r},u.VWO_TRACK_EVENT_ERROR),{trackEvent:()=>Promise.resolve({}),isReady:!1}}return{trackEvent:async(n,a={})=>{try{return o?n&&i.isString(n)?t&&i.isObject(t)&&t.id?await r.trackEvent(n,t,a):(e.error(l(u.INVALID_CONTEXT,{hookName:O.VWO_TRACK_EVENT})),Promise.resolve({})):(e.error(u.VWO_TRACK_EVENT_NAME_REQUIRED),Promise.resolve({})):(e.error(l(u.VWO_CLIENT_MISSING,{hookName:O.VWO_TRACK_EVENT})),Promise.resolve({}))}catch(r){return R(e,{error:r instanceof Error?r.message:r,eventName:n},u.VWO_TRACK_EVENT_ERROR),Promise.resolve({})}},isReady:o}},e.useVWOClient=()=>{let e;try{e=E();const r=T();return r?r.isReady?{vwoClient:r.vwoClient,isReady:!0}:V:(e.error(l(u.INVALID_HOOK_USAGE,{hookName:O.VWO_CLIENT})),V)}catch(r){return R(e,{error:r,hookName:O.VWO_CLIENT},u.HOOK_ERROR),V}},e.useVWOContext=T,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=vwo-fme-react-sdk.umd.production.min.js.map
