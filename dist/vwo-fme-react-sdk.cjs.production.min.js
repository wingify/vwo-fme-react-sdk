
/**
 * Copyright 2025 Wingify Software Pvt. Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,r=require("react"),t=(e=r)&&"object"==typeof e&&"default"in e?e.default:e,o=require("vwo-fme-node-sdk"),n=require("@wingify/service-logger"),i=require("@wingify/util-data-type");let a=null;function _(e){return a||(a=new n.LogManager((null==e?void 0:e.logger)||{})),a}function s(){return a||(a=new n.LogManager({level:"error"})),a}var E;!function(e){e.VWO_CLIENT_MISSING="VWO Client is missing in {hookName} hook. Ensure VWOProvider is correctly initialized.",e.INVALID_CONTEXT="Invalid user context in {hookName} hook. Ensure a valid userContext is provided.",e.HOOK_ERROR="Error in {hookName} hook: {error}",e.INVALID_HOOK_USAGE="{hookName} must be used within a VWOProvider !!",e.VWO_PROVIDER_CLIENT_CONFIG_WARNING="VWOProvider Warning: Both `client` and `config` are provided. The `client` prop will take precedence, and the `config` props will be disregarded.",e.VWO_PROVIDER_CONFIG_REQUIRED="VWOProvider Error: Either `client` or `config` must be provided.",e.VWO_SDK_INITIALIZATION_FAILED="VWO-SDK Initialization failed: {error}",e.VWO_TRACK_EVENT_NAME_REQUIRED="Event name is required for useTrackEvent hook and it should be a string",e.VWO_TRACK_EVENT_ERROR="Error tracking event - {eventName}: {error}",e.VWO_SET_ATTRIBUTE_MAP_REQUIRED="attributeMap (object having key-value pairs of user attributes) is required for useSetAttribute hook",e.VWO_SET_ATTRIBUTE_ERROR="Error setting attributes: {error}",e.VWO_SET_ATTRIBUTE_SUCCESS="User attributes set: {attributes}",e.VWO_NOT_READY_IN_USE_GET_FLAG="VWO is not ready in useGetFlag hook",e.VWO_GET_FLAG_FEATURE_KEY_REQUIRED="Feature key is required for useGetFlag hook",e.VWO_GET_FLAG_ERROR="Error fetching feature flag - {featureKey}: {error}",e.VWO_GET_FLAG_VARIABLES_FLAG_REQUIRED="Flag is required for useGetFlagVariables hook and should be an object",e.VWO_GET_FLAG_VARIABLES_ERROR="Error getting flag variables: {error}",e.VWO_GET_FLAG_VARIABLE_REQUIRED="Flag and variable key are required for useGetFlagVariable hook",e.VWO_GET_FLAG_VARIABLE_ERROR="Error getting flag variable: {error}"}(E||(E={}));const u=/\{([0-9a-zA-Z_]+)\}/g;function l(e,r={}){try{return e.replace(u,(t,o,n)=>{if("{"===e[n-1]&&"}"===e[n+t.length])return o;const a=r[o];return null==a?"":i.isFunction(a)?a():a})}catch(r){return e}}var O;!function(e){e.VWO_CLIENT="useVWOClient",e.VWO_CONTEXT="useVWOContext",e.VWO_GET_FLAG="useGetFlag",e.VWO_GET_FLAG_VARIABLE="useGetFlagVariable",e.VWO_GET_FLAG_VARIABLES="useGetFlagVariables",e.VWO_TRACK_EVENT="useTrackEvent",e.VWO_SET_ATTRIBUTE="useSetAttribute"}(O||(O={}));const R=r.createContext({vwoClient:null,userContext:null,setUserContext:void 0,isReady:!1}),T=()=>{const e=s();try{return r.useContext(R)||(e.error(l(E.INVALID_HOOK_USAGE,{hookName:O.VWO_CONTEXT})),null)}catch(r){return e.error(l(E.HOOK_ERROR,{error:r,hookName:O.VWO_CONTEXT})),null}},V={vwoClient:null,isReady:!1};Object.defineProperty(exports,"Flag",{enumerable:!0,get:function(){return o.Flag}}),Object.defineProperty(exports,"LogLevelEnum",{enumerable:!0,get:function(){return o.LogLevelEnum}}),Object.defineProperty(exports,"StorageConnector",{enumerable:!0,get:function(){return o.StorageConnector}}),Object.defineProperty(exports,"init",{enumerable:!0,get:function(){return o.init}}),exports.VWOProvider=function(e){const{userContext:n,children:i,fallbackComponent:a}=e,s="client"in e?e.client:null,u="config"in e?e.config:null,[O,T]=r.useState(s||null),[V,c]=r.useState(n||null),[A,I]=r.useState(!1),N=_((null==s?void 0:s.options)||u),g=r.useMemo(()=>u||(null==s?void 0:s.options),[]);return r.useEffect(()=>{u&&O&&N.warn(E.VWO_PROVIDER_CLIENT_CONFIG_WARNING),O?I(!0):u?!O&&u&&(async()=>{try{if(!O&&u){const e=await o.init(u);T(e),I(!0)}}catch(e){N.error(l(E.VWO_SDK_INITIALIZATION_FAILED,{error:e}))}})():N.error(E.VWO_PROVIDER_CONFIG_REQUIRED)},[g]),t.createElement(R.Provider,{value:{vwoClient:O,userContext:V,setUserContext:c,isReady:A}},a&&!A?a:i)},exports.useGetFlag=(e,t)=>{const{vwoClient:o,userContext:n,setUserContext:a,isReady:_}=T(),[u,R]=r.useState({isEnabled:()=>!1,getVariables:()=>[],getVariable:(e,r)=>r}),[V,c]=r.useState(!0),A=s(),I=r.useMemo(()=>t||n||{},[JSON.stringify(t||n||{})]),N=r.useCallback(async()=>{try{if(!_)return void A.error(E.VWO_NOT_READY_IN_USE_GET_FLAG);const r=await o.getFlag(e,I);R(r),a(I)}catch(r){A.error(l(E.VWO_GET_FLAG_ERROR,{featureKey:e,error:r}))}finally{c(!1)}},[e,I,_]);return r.useEffect(()=>{e?i.isObject(I)&&I.id?_&&o&&I&&N():A.error(l(E.INVALID_CONTEXT,{hookName:O.VWO_GET_FLAG})):A.error(E.VWO_GET_FLAG_FEATURE_KEY_REQUIRED)},[e,JSON.stringify(I),_]),{flag:u,isReady:!V&&!!u}},exports.useGetFlagVariable=(e,r,t)=>{const o=s();try{return e&&i.isObject(e)?r?e.getVariable(r,t):(o.error(E.VWO_GET_FLAG_VARIABLE_REQUIRED),t):t}catch(e){return o.error(l(E.VWO_GET_FLAG_VARIABLE_ERROR,{error:e})),t}},exports.useGetFlagVariables=e=>{const r=s();try{return e&&i.isObject(e)?e.getVariables():(r.error(E.VWO_GET_FLAG_VARIABLES_FLAG_REQUIRED),[])}catch(e){return r.error(l(E.VWO_GET_FLAG_VARIABLES_ERROR,{error:e})),[]}},exports.useSetAttribute=()=>{const e=s(),{vwoClient:r,userContext:t,isReady:o}=T();return{setAttribute:n=>{if(o)if(t&&i.isObject(t)&&t.id)if(n&&i.isObject(n)&&0!==Object.keys(n).length)try{r.setAttribute(n,t),e.info(l(E.VWO_SET_ATTRIBUTE_SUCCESS,{attributes:JSON.stringify(n)}))}catch(r){e.error(l(E.VWO_SET_ATTRIBUTE_ERROR,{error:r}))}else e.error(E.VWO_SET_ATTRIBUTE_MAP_REQUIRED);else e.error(l(E.INVALID_CONTEXT,{hookName:O.VWO_SET_ATTRIBUTE}));else e.error(l(E.VWO_CLIENT_MISSING,{hookName:O.VWO_SET_ATTRIBUTE}))},isReady:o}},exports.useTrackEvent=()=>{const e=s(),{vwoClient:r,userContext:t,isReady:o}=T();return{trackEvent:async(n,a={})=>{if(!o)return e.error(l(E.VWO_CLIENT_MISSING,{hookName:O.VWO_TRACK_EVENT})),Promise.resolve({});if(!n||!i.isString(n))return e.error(E.VWO_TRACK_EVENT_NAME_REQUIRED),Promise.resolve({});if(!t||!i.isObject(t)||!t.id)return e.error(l(E.INVALID_CONTEXT,{hookName:O.VWO_TRACK_EVENT})),Promise.resolve({});try{return await r.trackEvent(n,t,a)}catch(r){return e.error(l(E.VWO_TRACK_EVENT_ERROR,{eventName:n,error:r instanceof Error?r.message:r})),Promise.resolve({})}},isReady:o}},exports.useVWOClient=()=>{const e=s();try{const r=T();return r?r.isReady?{vwoClient:r.vwoClient,isReady:!0}:V:(e.error(l(E.INVALID_HOOK_USAGE,{hookName:O.VWO_CLIENT})),V)}catch(r){return e.error(l(E.HOOK_ERROR,{error:r,hookName:O.VWO_CLIENT})),V}},exports.useVWOContext=T;
//# sourceMappingURL=vwo-fme-react-sdk.cjs.production.min.js.map
