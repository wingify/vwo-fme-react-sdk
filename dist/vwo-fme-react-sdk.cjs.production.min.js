
/**
 * Copyright 2025 Wingify Software Pvt. Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,r=require("react"),t=(e=r)&&"object"==typeof e&&"default"in e?e.default:e,o=require("vwo-fme-node-sdk"),n=require("@wingify/service-logger"),i=require("@wingify/util-data-type");let a=null;function _(e){return a||(a=new n.LogManager((null==e?void 0:e.logger)||{})),a}function E(){return a||(a=new n.LogManager({level:"error"})),a}var s;!function(e){e.VWO_CLIENT_MISSING="VWO Client is missing in {hookName} hook. Ensure VWOProvider is correctly initialized.",e.INVALID_CONTEXT="Invalid user context in {hookName} hook. Ensure a valid userContext is provided.",e.HOOK_ERROR="Error in {hookName} hook: {error}",e.INVALID_HOOK_USAGE="{hookName} must be used within a VWOProvider !!",e.VWO_PROVIDER_CLIENT_CONFIG_WARNING="VWOProvider Warning: Both `client` and `config` are provided. The `client` prop will take precedence, and the `config` props will be disregarded.",e.VWO_PROVIDER_CONFIG_REQUIRED="VWOProvider Error: Either `client` or `config` must be provided.",e.VWO_SDK_INITIALIZATION_FAILED="VWO-SDK Initialization failed: {error}",e.VWO_TRACK_EVENT_NAME_REQUIRED="Event name is required for useTrackEvent hook and it should be a string",e.VWO_TRACK_EVENT_ERROR="Error tracking event - {eventName}: {error}",e.VWO_SET_ATTRIBUTE_MAP_REQUIRED="attributeMap (object having key-value pairs of user attributes) is required for useSetAttribute hook",e.VWO_SET_ATTRIBUTE_ERROR="Error setting attributes: {error}",e.VWO_SET_ATTRIBUTE_SUCCESS="User attributes set: {attributes}",e.VWO_NOT_READY_IN_USE_GET_FLAG="VWO is not ready in useGetFlag hook",e.VWO_GET_FLAG_FEATURE_KEY_REQUIRED="Feature key is required for useGetFlag hook",e.VWO_GET_FLAG_ERROR="Error fetching feature flag - {featureKey}: {error}",e.VWO_GET_FLAG_VARIABLES_FLAG_REQUIRED="Flag is required for useGetFlagVariables hook and should be an object",e.VWO_GET_FLAG_VARIABLES_ERROR="Error getting flag variables: {error}",e.VWO_GET_FLAG_VARIABLE_REQUIRED="Flag and variable key are required for useGetFlagVariable hook",e.VWO_GET_FLAG_VARIABLE_ERROR="Error getting flag variable: {error}"}(s||(s={}));const u=/\{([0-9a-zA-Z_]+)\}/g;function l(e,r={}){try{return e.replace(u,(t,o,n)=>{if("{"===e[n-1]&&"}"===e[n+t.length])return o;const a=r[o];return null==a?"":i.isFunction(a)?a():a})}catch(r){return e}}function R(e,r={},t){try{e.error(l(t,r))}catch(e){console.error("Error logging hook. Error: "+e)}}var O;!function(e){e.VWO_CLIENT="useVWOClient",e.VWO_CONTEXT="useVWOContext",e.VWO_GET_FLAG="useGetFlag",e.VWO_GET_FLAG_VARIABLE="useGetFlagVariable",e.VWO_GET_FLAG_VARIABLES="useGetFlagVariables",e.VWO_TRACK_EVENT="useTrackEvent",e.VWO_SET_ATTRIBUTE="useSetAttribute"}(O||(O={}));const T=r.createContext({vwoClient:null,userContext:null,setUserContext:void 0,isReady:!1}),c=()=>{let e;try{return e=E(),r.useContext(T)||(e.error(l(s.INVALID_HOOK_USAGE,{hookName:O.VWO_CONTEXT})),null)}catch(r){return R(e,{error:r,hookName:O.VWO_CONTEXT},s.HOOK_ERROR),null}},V={vwoClient:null,isReady:!1};Object.defineProperty(exports,"Flag",{enumerable:!0,get:function(){return o.Flag}}),Object.defineProperty(exports,"LogLevelEnum",{enumerable:!0,get:function(){return o.LogLevelEnum}}),Object.defineProperty(exports,"StorageConnector",{enumerable:!0,get:function(){return o.StorageConnector}}),Object.defineProperty(exports,"init",{enumerable:!0,get:function(){return o.init}}),exports.VWOProvider=function(e){const{userContext:n,children:i,fallbackComponent:a}=e,E="client"in e?e.client:null,u="config"in e?e.config:null,[l,O]=r.useState(E||null),[c,V]=r.useState(n||null),[A,I]=r.useState(!1),d=r.useMemo(()=>u||(null==E?void 0:E.options),[]);let g;return r.useEffect(()=>{try{if(g=_((null==E?void 0:E.options)||u),u&&l&&g.warn(s.VWO_PROVIDER_CLIENT_CONFIG_WARNING),l)return void I(!0);if(!u)return void g.error(s.VWO_PROVIDER_CONFIG_REQUIRED);const e=async()=>{if(!l&&u){const e=await o.init(u);O(e),I(!0)}};!l&&u&&e()}catch(e){R(g,e,s.VWO_SDK_INITIALIZATION_FAILED)}},[d]),t.createElement(T.Provider,{value:{vwoClient:l,userContext:c,setUserContext:V,isReady:A}},a&&!A?a:i)},exports.useGetFlag=(e,t)=>{const{vwoClient:o,userContext:n,setUserContext:a,isReady:_}=c(),[u,T]=r.useState({isEnabled:()=>!1,getVariables:()=>[],getVariable:(e,r)=>r}),[V,A]=r.useState(!0),I=E(),d=r.useMemo(()=>t||n||{},[JSON.stringify(t||n||{})]),g=r.useCallback(async()=>{try{if(!_)return void I.error(s.VWO_NOT_READY_IN_USE_GET_FLAG);const r=await o.getFlag(e,d);T(r),a(d)}catch(r){R(I,{error:r,featureKey:e},s.VWO_GET_FLAG_ERROR)}finally{A(!1)}},[e,d,_]);return r.useEffect(()=>{try{if(!e)return void I.error(s.VWO_GET_FLAG_FEATURE_KEY_REQUIRED);if(!i.isObject(d)||!d.id)return void I.error(l(s.INVALID_CONTEXT,{hookName:O.VWO_GET_FLAG}));_&&o&&d&&g()}catch(r){R(I,{error:r,featureKey:e},s.VWO_GET_FLAG_ERROR)}},[e,JSON.stringify(d),_]),{flag:u,isReady:!V&&!!u}},exports.useGetFlagVariable=(e,r,t)=>{let o;try{return o=E(),e&&i.isObject(e)?r?e.getVariable(r,t):(o.error(s.VWO_GET_FLAG_VARIABLE_REQUIRED),t):t}catch(e){return R(o,{error:e},s.VWO_GET_FLAG_VARIABLE_ERROR),t}},exports.useGetFlagVariables=e=>{let r;try{return r=E(),e&&i.isObject(e)?e.getVariables():(r.error(s.VWO_GET_FLAG_VARIABLES_FLAG_REQUIRED),[])}catch(e){return R(r,{error:e},s.VWO_GET_FLAG_VARIABLES_ERROR),[]}},exports.useSetAttribute=()=>{let e,r,t,o;try{e=E(),({vwoClient:r,userContext:t,isReady:o}=c())}catch(r){return R(e,{error:r},s.VWO_SET_ATTRIBUTE_ERROR),{setAttribute:()=>{},isReady:!1}}return{setAttribute:n=>{try{if(!o)return void e.error(l(s.VWO_CLIENT_MISSING,{hookName:O.VWO_SET_ATTRIBUTE}));if(!t||!i.isObject(t)||!t.id)return void e.error(l(s.INVALID_CONTEXT,{hookName:O.VWO_SET_ATTRIBUTE}));if(!n||!i.isObject(n)||0===Object.keys(n).length)return void e.error(s.VWO_SET_ATTRIBUTE_MAP_REQUIRED);r.setAttribute(n,t),e.info(l(s.VWO_SET_ATTRIBUTE_SUCCESS,{attributes:JSON.stringify(n)}))}catch(r){R(e,{error:r},s.VWO_SET_ATTRIBUTE_ERROR)}},isReady:o}},exports.useTrackEvent=()=>{let e,r,t,o;try{e=E(),({vwoClient:r,userContext:t,isReady:o}=c())}catch(r){return R(e,{error:r},s.VWO_TRACK_EVENT_ERROR),{trackEvent:()=>Promise.resolve({}),isReady:!1}}return{trackEvent:async(n,a={})=>{try{return o?n&&i.isString(n)?t&&i.isObject(t)&&t.id?await r.trackEvent(n,t,a):(e.error(l(s.INVALID_CONTEXT,{hookName:O.VWO_TRACK_EVENT})),Promise.resolve({})):(e.error(s.VWO_TRACK_EVENT_NAME_REQUIRED),Promise.resolve({})):(e.error(l(s.VWO_CLIENT_MISSING,{hookName:O.VWO_TRACK_EVENT})),Promise.resolve({}))}catch(r){return R(e,{error:r instanceof Error?r.message:r,eventName:n},s.VWO_TRACK_EVENT_ERROR),Promise.resolve({})}},isReady:o}},exports.useVWOClient=()=>{let e;try{e=E();const r=c();return r?r.isReady?{vwoClient:r.vwoClient,isReady:!0}:V:(e.error(l(s.INVALID_HOOK_USAGE,{hookName:O.VWO_CLIENT})),V)}catch(r){return R(e,{error:r,hookName:O.VWO_CLIENT},s.HOOK_ERROR),V}},exports.useVWOContext=c;
//# sourceMappingURL=vwo-fme-react-sdk.cjs.production.min.js.map
